# –ê–ª–∫–æ –¢–∞—Ä–æ - Telegram –±–æ—Ç

–¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç ¬´–ê–ª–∫–æ –¢–∞—Ä–æ¬ª —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π OpenAI (ChatGPT) –¥–ª—è –≥–∞–¥–∞–Ω–∏–π –Ω–∞ –∫–∞—Ä—Ç–∞—Ö –¢–∞—Ä–æ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –∞–ª–∫–æ–≥–æ–ª—å–Ω—ã—Ö –Ω–∞–ø–∏—Ç–∫–æ–≤.

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ë–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –¥–≤–∞ —Ç–∏–ø–∞ –≥–∞–¥–∞–Ω–∏–π:
1. **–¢–µ—Å—Ç–æ–≤–æ–µ –≥–∞–¥–∞–Ω–∏–µ** - –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –≥–∞–¥–∞–Ω–∏–µ —Å –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–æ–π –¢–∞—Ä–æ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π –Ω–∞–ø–∏—Ç–∫–∞ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑)
2. **–ü—Ä–µ–º–∏—É–º –≥–∞–¥–∞–Ω–∏–µ** - –ø–ª–∞—Ç–Ω–æ–µ –≥–∞–¥–∞–Ω–∏–µ —Å —Ç—Ä–µ–º—è –∫–∞—Ä—Ç–∞–º–∏ –¢–∞—Ä–æ, –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–µ–π –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –Ω–∞–ø–∏—Ç–∫–æ–≤

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/project_root
  ‚îú‚îÄ‚îÄ bot.py                     # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞, —Ä–æ—É—Ç–µ—Ä–æ–≤ –∏ –∑–∞–ø—É—Å–∫
  ‚îú‚îÄ‚îÄ pyproject.toml             # –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
  ‚îú‚îÄ‚îÄ requirements.txt           # –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
  ‚îú‚îÄ‚îÄ .env.example               # –ø—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
  ‚îú‚îÄ‚îÄ config.py                  # pydantic-–∫–ª–∞—Å—Å —Å –∫–æ–Ω—Ñ–∏–≥–æ–º (–∑–∞–≥—Ä—É–∂–∞–µ—Ç .env)
  ‚îú‚îÄ‚îÄ constants/
  ‚îÇ     ‚îú‚îÄ‚îÄ texts.py             # –≤—Å–µ —Ç–µ–∫—Å—Ç—ã/—à–∞–±–ª–æ–Ω—ã (HTML), –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Ü–µ–Ω, –∫–Ω–æ–ø–∫–∏
  ‚îÇ     ‚îî‚îÄ‚îÄ prompts.py           # –≤—Å–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è GPT
  ‚îú‚îÄ‚îÄ handlers/
  ‚îÇ     ‚îú‚îÄ‚îÄ tarot.py             # —Ö–µ–Ω–¥–ª–µ—Ä—ã –¥–ª—è /start, —Ç–µ—Å—Ç–∞, start_reading, premium
  ‚îÇ     ‚îî‚îÄ‚îÄ payments.py          # –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ payment/confirm
  ‚îú‚îÄ‚îÄ services/
  ‚îÇ     ‚îú‚îÄ‚îÄ openai_service.py    # –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ —Ä–∞–±–æ—Ç—ã —Å OpenAI + retry + JSON parse
  ‚îÇ     ‚îî‚îÄ‚îÄ payment_service.py   # –æ–±—ë—Ä—Ç–∫–∞ –¥–ª—è create_invoice / precheckout / success
  ‚îú‚îÄ‚îÄ keyboards/
  ‚îÇ     ‚îî‚îÄ‚îÄ inline.py            # —Ñ–∞–±—Ä–∏–∫–∏ inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä
  ‚îú‚îÄ‚îÄ utils/
  ‚îÇ     ‚îú‚îÄ‚îÄ storage.py           # –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (JSON atomic write + asyncio.Lock)
  ‚îÇ     ‚îî‚îÄ‚îÄ animations.py        # —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–π (edit_text) –∏ helper –¥–ª—è delays
  ‚îú‚îÄ‚îÄ models/
  ‚îÇ     ‚îî‚îÄ‚îÄ schemas.py           # Pydantic-–º–æ–¥–µ–ª–∏: Card, Reading, PremiumReading
  ‚îú‚îÄ‚îÄ tests/
  ‚îÇ     ‚îú‚îÄ‚îÄ test_openai_service.py
  ‚îÇ     ‚îú‚îÄ‚îÄ test_handlers.py
  ‚îÇ     ‚îî‚îÄ‚îÄ test_storage.py
  ‚îî‚îÄ‚îÄ .github/workflows/ci.yml    # —Ç–µ—Å—Ç—ã, –ª–∏–Ω—Ç –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11 –∏–ª–∏ –≤—ã—à–µ
- –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ (–ø–æ–ª—É—á–∏—Ç—å —É [@BotFather](https://t.me/BotFather))
- API –∫–ª—é—á OpenAI (–ø–æ–ª—É—á–∏—Ç—å –Ω–∞ [–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ OpenAI](https://platform.openai.com/))
- –¢–æ–∫–µ–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–ª–∞—Ç–µ–∂–µ–π Telegram (–¥–ª—è –ø—Ä–µ–º–∏—É–º-–≥–∞–¥–∞–Ω–∏–π)

## –î–µ–ø–ª–æ–π –Ω–∞ Replit

### 1. –ò–º–ø–æ—Ä—Ç –∏–∑ GitHub

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [Replit](https://replit.com/)
2. –ù–∞–∂–º–∏—Ç–µ "Create Repl"
3. –í—ã–±–µ—Ä–∏—Ç–µ "Import from GitHub"
4. –í—Å—Ç–∞–≤—å—Ç–µ URL –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
5. –ù–∞–∂–º–∏—Ç–µ "Import from GitHub"

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Replit

1. –í –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ Replit –Ω–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "Secrets" (üîí)
2. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```
BOT_TOKEN=your_telegram_bot_token_here
OPENAI_API_KEY=your_openai_api_key_here
PREMIUM_READING_PRICE=50
CURRENCY=XTR
OPENAI_MODEL=gpt-4-turbo
OPENAI_MAX_TOKENS=1000
OPENAI_TEMPERATURE=0.7
FREE_TEST_LIMIT=1
FREE_USERS=123456789,987654321
ANIMATION_DELAY_SHORT=0.5
ANIMATION_DELAY_MEDIUM=1.0
ANIMATION_DELAY_LONG=2.0
DEBUG=False
```

### 3. –ó–∞–ø—É—Å–∫ –Ω–∞ Replit

1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Run" –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞
2. Replit –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ `requirements.txt`
3. –ë–æ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∏ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Always On (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Repl
2. –í–∫–ª—é—á–∏—Ç–µ "Always On"
3. –≠—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç Replit Core –ø–æ–¥–ø–∏—Å–∫—É

## –õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/yourusername/alcobot.git
cd alcobot
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
python -m venv venv

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤ Windows
venv\Scripts\activate

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤ Linux/MacOS
source venv/bin/activate
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env`, —É–∫–∞–∑–∞–≤ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è:

```
# –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
DEBUG=False

# Telegram Bot
BOT_TOKEN=your_telegram_bot_token_here
WEBHOOK_URL=https://example.com/webhook  # –¢–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Å –≤–µ–±—Ö—É–∫–∞–º–∏
WEBHOOK_PATH=/webhook                    # –¢–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Å –≤–µ–±—Ö—É–∫–∞–º–∏
WEBAPP_HOST=0.0.0.0                      # –¢–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Å –≤–µ–±—Ö—É–∫–∞–º–∏
WEBAPP_PORT=8000                         # –¢–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Å –≤–µ–±—Ö—É–∫–∞–º–∏

# –ü–ª–∞—Ç–µ–∂–∏ —á–µ—Ä–µ–∑ Telegram Stars
PAYMENT_PROVIDER_TOKEN=  # –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è Telegram Stars
PREMIUM_READING_PRICE=50.0  # –¶–µ–Ω–∞ –≤ Telegram Stars
CURRENCY=XTR  # Telegram Stars

# OpenAI
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-4-turbo
OPENAI_MAX_TOKENS=1000
OPENAI_TEMPERATURE=0.7

# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
FREE_TEST_LIMIT=1
# –°–ø–∏—Å–æ–∫ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
FREE_USERS=123456789,987654321

# –ê–Ω–∏–º–∞—Ü–∏–∏
ANIMATION_DELAY_SHORT=0.5
ANIMATION_DELAY_MEDIUM=1.0
ANIMATION_DELAY_LONG=2.0
```

## –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (—Ä–µ–∂–∏–º long polling)

```bash
python bot.py
```

### –ó–∞–ø—É—Å–∫ —Å –≤–µ–±—Ö—É–∫–∞–º–∏ (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Å –≤–µ–±—Ö—É–∫–∞–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è `WEBHOOK_URL`, `WEBHOOK_PATH`, `WEBAPP_HOST` –∏ `WEBAPP_PORT` –≤ —Ñ–∞–π–ª–µ `.env`.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
pytest
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –æ—Ç—á–µ—Ç–æ–º –æ –ø–æ–∫—Ä—ã—Ç–∏–∏

```bash
pytest --cov=. --cov-report=html
```

## –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ —Å –ø–æ–º–æ—â—å—é Black

```bash
black .
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ —Å –ø–æ–º–æ—â—å—é Ruff

```bash
ruff check .
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ —Å –ø–æ–º–æ—â—å—é MyPy

```bash
mypy .
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API OpenAI

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –≥–∞–¥–∞–Ω–∏—è

```python
from services.openai_service import OpenAIService

async def example():
    openai_service = OpenAIService()
    test_reading = await openai_service.generate_test_reading()
    print(f"–ö–∞—Ä—Ç–∞: {test_reading.card.name}")
    print(f"–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è: {test_reading.interpretation}")
    print(f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –Ω–∞–ø–∏—Ç–æ–∫: {test_reading.drink.name}")
```

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –ø—Ä–µ–º–∏—É–º –≥–∞–¥–∞–Ω–∏—è

```python
from services.openai_service import OpenAIService

async def example():
    openai_service = OpenAIService()
    premium_reading = await openai_service.generate_tarot_reading("01.01.1990")
    print(f"–ö–∞—Ä—Ç—ã: {', '.join([card.name for card in premium_reading.cards])}")
    print(f"–û–±—â–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è: {premium_reading.interpretation}")
    print(f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞–ø–∏—Ç–∫–∏: {', '.join([drink.name for drink in premium_reading.drink_recommendations])}")
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## –î–∏—Å–∫–ª–µ–π–º–µ—Ä

–ë–æ—Ç –Ω–µ –ø–æ–æ—â—Ä—è–µ—Ç —á—Ä–µ–∑–º–µ—Ä–Ω–æ–µ —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –∞–ª–∫–æ–≥–æ–ª—è. –í—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–æ—Å—è—Ç —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä. –ë–æ—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–∏—Ü —Å—Ç–∞—Ä—à–µ 18 –ª–µ—Ç.